<?php
function page_header($title) {
    global $gallery_dir, $snimek, $galerie, $ThisScript, $theme;

    header("Content-Type: text/html; charset=utf-8");// make sure we send in utf8
?>
<!DOCTYPE html>
<html>
<head>

<meta name="robots" content="noindex, nofollow">

<!-- This makes IE6 suck less (a bit) -->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="inc/styles/ie6workarounds.css">
<script src="inc/styles/ie7/ie7-standard.js" type="text/javascript">
</script>
<![endif]-->

<title><?php echo $title; ?></title>

<link rel="icon" href="stock_camera-16.png" type="image/png">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<?php if ($snimek && $galerie) sequence_links($galerie, $snimek); ?>
<link type="text/css" rel="stylesheet" href="<?php echo $theme; ?>" media="screen">
     
<script src="inc/global.js" type="text/javascript"></script>
</head>
<body>
<h1 class="title"><a href="<?php echo $ThisScript; ?>">Photo Gallery<span></span></a></h1>
<?php
}


function page_footer() {
    global $copy, $app;
?>
<div class="footer">
    <?php echo $copy; ?><br>
    <?php echo __('Generated by'); ?>
    <em><a href="<?php echo $app["url"]; ?>"><?php echo $app["name"]; ?></a>
    ver. <?php echo $app["version"]; ?></em>
</div>
</body>
</html>
<?php
}


function sequence_links($gallery, $snapshot) {
    global $gallery_dir, $ThisScript;
    $prev = $snapshot - 1;
    $next = $snapshot + 1;
    if ($snapshot > 1) {
        echo "<link rel=\"prev\" ";
        echo "href=\"$ThisScript?galerie=$gallery&amp;photo=$prev\">\n";
    }
    if (is_file("$gallery_dir/$gallery/lq/img-$next.jpg")) {
        // Prefetch next page and image
        echo "<link rel=\"next prefetch\" ";
        echo "href=\"$ThisScript?galerie=$gallery&amp;photo=$next\">\n";
        echo "<link rel=\"prefetch\" ";
        echo "href=\"${ThisScript}galleries/$gallery/mq/img-$next.jpg\">\n";
    }
}


function page_navigation($gallery, $photo, $image) {
    global $ThisScript, $exif_style;
   if (!$image) { // this will render a navigation bar - max 3 buttons
      echo "\n<div class=\"navbuttons\">\n";
      echo "<div class=\"navbuttonsshell\">\n";
        if ($photo->has_prev()) { //previous
            $prev = $photo->get_prev()->number;
         echo "<a id=\"previcon\" href=\"$ThisScript?galerie=$gallery&amp;photo=$prev";
         echo "&amp;exif_style=$exif_style\"";
				 echo " accesskey=\"p\">";
         echo "&lt; <span class=\"accesskey\">P</span>revious</a>\n";
      }
      echo "&nbsp;";
        if ($photo->has_next()) { //next
            $next = $photo->get_next()->number;
         echo "<a id=\"nexticon\" href=\"$ThisScript?galerie=$gallery&amp;photo=$next";
         echo "&amp;exif_style=$exif_style\"";
				 echo " accesskey=\"n\">";
         echo "<span class=\"accesskey\">N</span>ext &gt;</a>\n";
      }
      echo "</div>\n</div>\n";
   } elseif ($image=="prev") { // previous image link
        if ($photo->has_prev()) {
            $prev = $photo->get_prev()->number;
         echo "<div class=\"prevthumb\">";
         echo "<a href=\"$ThisScript?galerie=$gallery&amp;photo=$prev";
         echo "&amp;exif_style=$exif_style\">";
         echo "</a></div>\n";
      }
   } else { // next image link
        if ($photo->has_next()) {
            $next = $photo->get_next()->number;
         echo "<div class=\"nextthumb\">";
         echo "<a href=\"$ThisScript?galerie=$gallery&amp;photo=$next";
         echo "&amp;exif_style=$exif_style\">";
         echo "</a></div>\n";
      }
   }
}


/** Mini thumbnail roll */
function thumb_roll($galerie, $snimek, $imgfiles) {
    global $ThisScript, $root, $gallery_dir;

    print "\n<!--mini thumbnail roll-->\n<div class=\"thumbroll\">";
    $start = $snimek - 3;
    $stop = $snimek + 3;
    $total = count($imgfiles->items);
    if ($snimek < 4)
        $stop = 7;
    if ($snimek > ($total - 4)) {
        $start = $total - 6;
    }
    while ($thumbfile = $imgfiles->read()) {
        if ( eregi("^img-([0-9]+)\.(png|jpe?g)", $thumbfile, $x)) {
            if ($x[1] < $start || $x[1] > $stop)
                continue;
            $thumb = "$gallery_dir/$galerie/thumbs/img-${x[1]}.${x[2]}";
            print "   <a href=\"$ThisScript?galerie=$galerie&amp;photo=${x[1]}\"";
            print " title=" . get_photo_title($galerie, $x[1]);
            if ($x[1] == $snimek)
                print " class='current'";
            print ">";
            print "<img class=\"thumb\" ";
            $minithumb=getimagesize("$root/$thumb");
            $h=60;
            $ratio = $minithumb[1]/60;
            $w=$minithumb[0]/$ratio;

            print " width=\"$w\" height=\"$h\"";
            print " src=\"$thumb\" ";
            print "alt=\"photo No. ${x[1]}\" />";
            print "</a> \n";
        }
    }
    if (file_exists("$gallery_dir/$galerie/zip/hq.zip")) {
        print "<a id=\"zip\" href=\"$gallery_dir/$galerie/zip/hq.zip\">";
        print "zip<span /></a>";
    }
    if (file_exists("$gallery_dir/$galerie/zip/hq.tar.bz2")) {
        print "<a id=\"zip\" href=\"$gallery_dir/$galerie/zip/hq.tar.bz2\">";
        print "zip<span /></a>";
    }
    print "</div>\n";
}


# return dirs sorted
class SortDir {
   var $items;

   function SortDir($directory) {
      $handle=@opendir($directory);
			if (!$handle) return;
      while ($file = readdir($handle)) {
         if ($file != "." && $file != "..") {
            $this->items[]=$file;
         }
      }
      closedir($handle);
	    if ($this->items) {
         natsort($this->items);
	    }
   }

   function Read() {
			if ($this->items) {
				$getback= (pos($this->items));
				next($this->items);
				return $getback;
			}
   }
}

?>
